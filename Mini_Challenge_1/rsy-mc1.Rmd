---
title: "RSY-MC1"
author: "Patrick, Ben"
output: 
  html_notebook:
    toc: True
    toc_float: True
---
# Mini-Challenge Beschreibung


# Daten und Libraries
```{r}
library(tidyverse)
library(recommenderlab)
```
## Daten einlesen
```{r}
data(MovieLense)
```

## Library Methoden zum Datensatz MovieLense
```{r}
methods(class = class(MovieLense))
```

## Kopfzeilen vom Datensatz ausgeben
```{r}
head(as(MovieLense, "data.frame"))
```

## Fusszeilen vom Datensatz ausgeben
```{r}
tail(as(MovieLense, "data.frame"))
```

## Info zum Datensatz
```{r}
summary(as(MovieLense, "data.frame"))
```
## Datenframe Variabel erstellen
```{r}
MovieLenseEDA <- as(MovieLense, "data.frame")
```


# Explorative Datenanalyse
Aufgabe 1: Untersuche den vollständigen MovieLense Datensatz 
(d.h. vor Datenreduktion!) und beantworte folgende Fragen

## 1. Welches sind die am häufigsten geschauten Genres/Filme?

### Filme
```{r}
MovieLenseEDA %>% 
  group_by(item) %>% 
  summarise(Anzahl = n()) %>%
  arrange(desc(Anzahl)) 
```

### Genre
```{r}
# Full Join mit df_movies_rating und MovieLenseMeta
MovieLenseEDA_Joined <- full_join(MovieLenseEDA, MovieLenseMeta, 
          by = c("item" = "title")) %>% 
  select(-c("user", "item", "rating", "year", "url")) 

# Aufsummieren der Genre Spalten
(colSums(MovieLenseEDA_Joined)) %>% sort(decreasing = TRUE)

### 
# Muessen wir Genre Unknown entfernen?
```

## 2. Wie verteilen sich die Kundenratings gesamthaft und nach Genres?
```{r}
# DataFrame join
MovieLenseEDA_Joined <- full_join(MovieLenseEDA, MovieLenseMeta, 
          by = c("item" = "title"))
```

### Verteilung der Kundenratings Gesamthaft
```{r}
MovieLenseEDA_Joined$rating <- as.factor(MovieLenseEDA_Joined$rating)

MovieLenseEDA_Joined %>% group_by(rating) %>%
  summarize(Anzahl = n()) %>% 
  ggplot(aes(x = rating, y = Anzahl)) + 
  geom_bar(stat = "identity", 
           fill = "lightblue", 
           color = "black") + 
  labs(x = "Ratings", 
       y = "Anzahl", 
       title = "Kundenratings Gesamthaft",
       subtitle = "MovieLenseData")
```

### Verteilung der Kundenratings nach Genre
```{r}
# DataFrame reshape 
MovieLenseEDA_Joined$rating <- as.integer(MovieLenseEDA_Joined$rating)

MovieLenseEDA_Joined %>% 
  select(-c("item", "user", "year", "url")) %>% 
  pivot_longer(cols=c("unknown", "Action", "Adventure", "Animation", "Children's",
                      "Comedy", "Crime", "Documentary", "Drama", "Fantasy",
                      "Film-Noir", "Horror", "Musical", "Mystery", "Horror",
                      "Musical", "Mystery", "Romance", "Sci-Fi", "Thriller",
                      "War", "Western"),
               names_to = "Genre", values_to = "X") %>% 
  ggplot(aes(x = rating)) +
  geom_bar(fill = "lightblue", color = "black") + 
  facet_wrap(~Genre)

# Alle Plots sehen identisch aus? 
  
```

```{r}


MovieLenseHistoGenreRating <- MovieLenseEDA_Joined %>% 
  select(-c("item", "user", "year", "url")) %>% 
  pivot_longer(cols=c("unknown", "Action", "Adventure", "Animation", "Children's",
                      "Comedy", "Crime", "Documentary", "Drama", "Fantasy",
                      "Film-Noir", "Horror", "Musical", "Mystery", "Horror",
                      "Musical", "Mystery", "Romance", "Sci-Fi", "Thriller",
                      "War", "Western"),
               names_to = "Genre", values_to = "X") %>%
  group_by(Genre, rating) %>%
  summarize(Anzahl = n()) 
  
MovieLenseHistoGenreRating$rating <- as.factor(MovieLenseHistoGenreRating$rating)

MovieLenseHistoGenreRating 
# ToDO Vis fehlt
```


## 3. Wie verteilen sich die mittleren Kundenratings pro Film?
```{r}
MovieLenseEDA %>% 
  group_by(item) %>% 
  summarize(mean_rating_per_film = mean(rating)) %>% 
  ggplot(aes(x = mean_rating_per_film)) + 
  geom_histogram(color = "black", fill = "lightblue", binwidth = 0.5) +
    labs(x = "Ratings", 
       y = "Anzahl", 
       title = "Mittlere Kundenratings verteilung",
       subtitle = "MovieLenseData")
  
```

## 4. Wie stark streuen die Ratings von individuellen Kunden?
```{r}
MovieLenseEDA %>% filter(user == c(1:9)) %>% 
  ggplot(aes(x = user, y = rating)) +
  geom_violin(color = "black", fill = "lightblue") 

# Beschriftung und Farbe
```

## 5. Welchen Einfluss hat die Normierung der Ratings pro Kunde auf deren Verteilung?
```{r}
MovieLensenormalized <- normalize(MovieLense)
MovieLenseEDA_Normalized <- (as(MovieLensenormalized, "data.frame"))

MovieLenseEDA_Normalized %>% filter(user == c(1:9)) %>% 
  ggplot(aes(x = user, y = rating)) +
  geom_violin(color = "black", fill = "lightblue") 

# Labelings & Interpreation

```

## 6. Welche strukturellen Charakteristika (z.B. Sparsity) und Auffälligkeiten zeigt die User-Item Matrix?
```{r}
image(MovieLense) 

# Labeling + Interpreation + Antwort fehlt. 
# Aufsteigend nach Anzahl bewertete Filmen
# Film Besonders die ersten 400 Filme wurden am meisten bewrtet.
# User kein Muster erkennbar
```

```{r}
# nratings => Gibt mir die Anzahl Bewerteten Filme in der Matrix
# dim(MovieLense) gibt mir die Dimension (Zeilen, Spalten)

nratings(MovieLense) / (dim(MovieLense)[1] * dim(MovieLense)[2]) * 100
```











